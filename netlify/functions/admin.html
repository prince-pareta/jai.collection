<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JAI ADMIN | Pro Suite</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>

    <style>
        :root { --nav-w: 250px; --primary: #000; --bg: #F4F6F8; }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; }
        body { display: flex; background: var(--bg); height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: var(--nav-w); background: white; border-right: 1px solid #ddd; padding: 20px; display: flex; flex-direction: column; }
        .brand { font-size: 20px; font-weight: 800; margin-bottom: 40px; letter-spacing: -0.5px; }
        .menu-item { padding: 12px 15px; color: #555; cursor: pointer; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 500; }
        .menu-item.active, .menu-item:hover { background: #f0f0f0; color: black; }
        .menu-item i { width: 20px; }

        /* MAIN CONTENT */
        .main { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title { font-size: 24px; font-weight: 700; }
        
        /* CARDS */
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; border: 1px solid #eee; }
        .stat-num { font-size: 28px; font-weight: 700; margin-top: 10px; }
        
        /* CATALOGUE TABLE */
        .table-card { background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden; }
        .tbl-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .btn-black { background: black; color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #fafafa; color: #666; font-weight: 500; }
        .prod-row img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }

        /* MODAL FORM */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 100; display: none; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 600px; padding: 30px; border-radius: 16px; max-height: 90vh; overflow-y: auto; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .inp-grp { margin-bottom: 15px; }
        .inp-grp label { display: block; font-size: 12px; margin-bottom: 5px; font-weight: 600; }
        .inp-grp input, .inp-grp select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .upload-area { border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">JAI ADMIN.</div>
        <div class="menu-item active" onclick="showPage('dashboard')"><i class="fas fa-chart-pie"></i> Dashboard</div>
        <div class="menu-item" onclick="showPage('catalogue')"><i class="fas fa-tshirt"></i> Catalogue</div>
        <div class="menu-item" onclick="showPage('orders')"><i class="fas fa-shopping-bag"></i> Orders</div>
        <div style="margin-top:20px; font-size:11px; color:#999; padding-left:15px; text-transform:uppercase; letter-spacing:1px; margin-bottom:10px;">Growth</div>
        <div class="menu-item"><i class="fas fa-bullhorn"></i> Marketing</div>
        <div class="menu-item"><i class="fas fa-search"></i> SEO Score</div>
        <div class="menu-item"><i class="fas fa-gift"></i> Coupons</div>
    </div>

    <div class="main">
        <div id="pg-dashboard">
            <div class="header">
                <div class="page-title">Store Overview</div>
                <div style="font-size:14px; color:#666;">Last 30 Days</div>
            </div>
            <div class="stats-row">
                <div class="stat-card">
                    <div style="color:#666; font-size:12px;">Total Revenue</div>
                    <div class="stat-num">₹45,200</div>
                </div>
                <div class="stat-card">
                    <div style="color:#666; font-size:12px;">Active Orders</div>
                    <div class="stat-num" id="ordCount">0</div>
                </div>
                <div class="stat-card">
                    <div style="color:#666; font-size:12px;">Products</div>
                    <div class="stat-num" id="prodCount">0</div>
                </div>
            </div>
        </div>

        <div id="pg-catalogue" style="display:none;">
            <div class="header">
                <div class="page-title">Product Catalogue</div>
                <button class="btn-black" onclick="openModal()">+ Add Product</button>
            </div>
            <div class="table-card">
                <table>
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="prodTable"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal" id="prodModal">
        <div class="modal-content">
            <h2 style="margin-bottom:20px;">Add New Item</h2>
            
            <div class="upload-area" id="upBtn">
                <i class="fas fa-cloud-upload-alt"></i> Click to Upload Images
                <div id="preview" style="display:flex; gap:5px; justify-content:center; margin-top:10px;"></div>
            </div>

            <div class="form-grid">
                <div class="inp-grp">
                    <label>Product Name</label>
                    <input type="text" id="pName">
                </div>
                <div class="inp-grp">
                    <label>Category</label>
                    <select id="pCat">
                        <option>Men</option>
                        <option>Women</option>
                        <option>Kids</option>
                    </select>
                </div>
            </div>

            <div class="form-grid">
                <div class="inp-grp">
                    <label>Price</label>
                    <input type="number" id="pPrice">
                </div>
                <div class="inp-grp">
                    <label>Sizes (e.g. S,M,L)</label>
                    <input type="text" id="pSizes">
                </div>
            </div>

            <button class="btn-black" style="width:100%" onclick="saveProduct()">Save Product</button>
            <button onclick="closeModal()" style="width:100%; margin-top:10px; background:none; border:none; cursor:pointer;">Cancel</button>
        </div>
    </div>

<script>
    const API = '/.netlify/functions/api';
    let images = [];

    // --- NAVIGATION ---
    function showPage(pg) {
        document.querySelectorAll('.main > div').forEach(d => d.style.display = 'none');
        document.getElementById('pg-'+pg).style.display = 'block';
        if(pg === 'catalogue') loadProducts();
        if(pg === 'dashboard') loadStats();
    }

    // --- CLOUDINARY ---
    const widget = cloudinary.createUploadWidget({
        cloudName: 'dsd1iiqlf', 
        uploadPreset: 'unsigned_upload',
        apiKey: '766764513921343',
        sources: ['local', 'camera']
    }, (err, res) => {
        if (!err && res && res.event === "success") {
            images.push(res.info.secure_url);
            document.getElementById('preview').innerHTML += `<img src="${res.info.secure_url}" style="width:40px; height:40px;">`;
        }
    });
    document.getElementById('upBtn').addEventListener('click', () => widget.open());

    // --- API CALLS ---
    async function loadStats() {
        const res = await fetch(`${API}?path=stats`);
        const data = await res.json();
        document.getElementById('prodCount').innerText = data.products;
        document.getElementById('ordCount').innerText = data.orders;
    }

    async function loadProducts() {
        const res = await fetch(`${API}?path=products`);
        const data = await res.json();
        const tbody = document.getElementById('prodTable');
        tbody.innerHTML = "";
        data.forEach(p => {
            tbody.innerHTML += `
                <tr class="prod-row">
                    <td><img src="${p.images?p.images[0]:''}"></td>
                    <td>${p.name}</td>
                    <td>${p.category}</td>
                    <td>₹${p.price}</td>
                    <td><i class="fas fa-trash" style="color:red; cursor:pointer;" onclick="delProd(${p.id})"></i></td>
                </tr>
            `;
        });
    }

    async function saveProduct() {
        const data = {
            name: document.getElementById('pName').value,
            price: document.getElementById('pPrice').value,
            category: document.getElementById('pCat').value,
            variants: JSON.stringify({ sizes: document.getElementById('pSizes').value.split(',') }),
            images: images
        };
        await fetch(`${API}?path=products`, { method: 'POST', body: JSON.stringify(data) });
        closeModal();
        loadProducts();
    }

    async function delProd(id) {
        if(confirm('Delete?')) {
            await fetch(`${API}?id=${id}`, { method: 'DELETE' });
            loadProducts();
        }
    }

    // --- MODAL ---
    function openModal() { document.getElementById('prodModal').style.display='flex'; images=[]; document.getElementById('preview').innerHTML=''; }
    function closeModal() { document.getElementById('prodModal').style.display='none'; }

    // Init
    loadStats();
</script>
</body>
</html>